---
title: "Authentication"
sidebarTitle: "Authentication"
description: "How authentication works on the BeatPass API using Laravel Sanctum's cookie-based SPA authentication."
keywords: ["beatpass auth", "sanctum authentication", "spa authentication", "csrf token", "session cookies"]
"og:title": "Authentication - BeatPass Developer Docs"
"og:description": "Learn how BeatPass API authentication works using Laravel Sanctum's cookie-based SPA sessions."
---

## Overview

BeatPass uses **Laravel Sanctum** for SPA (single-page application) authentication. This is a **cookie-based session authentication** system designed for first-party frontend applications.

<Warning>
  BeatPass does not issue API tokens or support third-party integrations. This API is for the BeatPass web application only.
</Warning>

---

## Authentication Model

BeatPass uses **stateful SPA authentication**:

<CardGroup cols={2}>
  <Card title="Cookie Sessions" icon="cookie" color="#f59e0b">
    All auth uses secure, HttpOnly session cookies
  </Card>
  <Card title="CSRF Required" icon="shield-check" color="#22c55e">
    State-changing requests require CSRF tokens
  </Card>
  <Card title="No API Tokens" icon="key-skeleton" color="#6b7280">
    Personal access tokens are not issued
  </Card>
  <Card title="First-Party Only" icon="lock" color="#ef4444">
    Third-party integrations not supported
  </Card>
</CardGroup>

---

## SPA Authentication Flow

The BeatPass frontend authenticates using Sanctum's SPA authentication:

<Steps>
  <Step title="Get CSRF Cookie">
    Before login, request a CSRF cookie:
    ```http
    GET /sanctum/csrf-cookie
    ```
    This sets the `XSRF-TOKEN` cookie.
  </Step>
  
  <Step title="Submit Login">
    POST credentials with the CSRF token:
    ```http
    POST /auth/login
    Content-Type: application/json
    X-XSRF-TOKEN: {token-from-cookie}
    
    {
      "email": "user@example.com",
      "password": "your-password"
    }
    ```
  </Step>
  
  <Step title="Handle 2FA (if enabled)">
    If 2FA is enabled, you'll receive a `two_factor: true` response.
    Submit the TOTP code:
    ```http
    POST /auth/two-factor-challenge
    
    { "code": "123456" }
    ```
  </Step>
  
  <Step title="Session Established">
    On success, a session cookie is set. All subsequent requests include this cookie automatically.
  </Step>
</Steps>

---

## CSRF Protection

<Warning>
  All state-changing requests (POST, PUT, DELETE) require CSRF protection.
</Warning>

### How CSRF Works

1. **Cookie:** Sanctum sets an `XSRF-TOKEN` cookie (URL-encoded)
2. **Header:** Include the decoded token in `X-XSRF-TOKEN` header
3. **Verification:** Laravel verifies the header matches the cookie

### JavaScript Example

```javascript
// Read CSRF token from cookie
function getCsrfToken() {
  const cookie = document.cookie
    .split('; ')
    .find(row => row.startsWith('XSRF-TOKEN='));
  return cookie ? decodeURIComponent(cookie.split('=')[1]) : null;
}

// Make authenticated request
async function apiPost(url, data) {
  const response = await fetch(url, {
    method: 'POST',
    credentials: 'include', // Include cookies
    headers: {
      'Content-Type': 'application/json',
      'Accept': 'application/json',
      'X-XSRF-TOKEN': getCsrfToken()
    },
    body: JSON.stringify(data)
  });
  return response.json();
}
```

### Axios Configuration

```javascript
// Axios automatically handles XSRF-TOKEN cookies
axios.defaults.withCredentials = true;
axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
```

---

## Stateful Domains

Cookie-based authentication is only available from approved BeatPass domains. Requests from other origins will not receive authenticated sessions.

<Note>
  This is a first-party API. Cross-origin requests from third-party domains are not supported.
</Note>

---

## Optional vs Required Auth

### Optional Auth Endpoints

Many endpoints work without authentication but return enhanced data when authenticated:

```http
GET /tracks           # Public track list
GET /tracks/{id}      # Track details (shows purchase status if authed)
GET /artists/{id}     # Artist profile (shows follow status if authed)
GET /search           # Search results
```

### Required Auth Endpoints

These endpoints require an authenticated session:

```http
POST /tracks                           # Upload track
PUT  /tracks/{track}                   # Update track
POST /tracks/{track}/purchase/initiate # Purchase flow
GET  /purchases                        # User purchases
GET  /messaging/conversations          # Messages
POST /beat-requests                    # Create request
GET  /producer-intelligence/dashboard  # Analytics
```

---

## Two-Factor Authentication

When 2FA is enabled, the login flow requires an additional step:

### Initial Login Response (2FA Required)

```json
{
  "two_factor": true,
  "message": "Two factor authentication required"
}
```

### Submit 2FA Code

```http
POST /auth/two-factor-challenge
Content-Type: application/json

{
  "code": "123456"
}
```

Or use a recovery code:

```json
{
  "recovery_code": "abcd-efgh-ijkl"
}
```

---

## Session Security

### Best Practices

<AccordionGroup>
  <Accordion title="HTTPS Only">
    All API requests must use HTTPS. Cookies sent over HTTP can be intercepted.
  </Accordion>
  
  <Accordion title="Cookie Security">
    Session cookies are HttpOnly and SameSite-protected. Never expose cookie values in client code.
  </Accordion>
  
  <Accordion title="Session Management">
    Users can log out other sessions from Account Settings â†’ Active Sessions.
  </Accordion>
  
  <Accordion title="Session Expiration">
    Web sessions expire based on server configuration. Re-authenticate when sessions expire.
  </Accordion>
</AccordionGroup>

### Logging Out

Users can log out of the current session, or log out all other sessions from the **Active sessions** panel in Account Settings.

---

## Authentication Errors

<AccordionGroup>
  <Accordion title="401 Unauthenticated" icon="circle-xmark">
    <Badge color="red">401</Badge> Session missing, invalid, or expired.
    
    **Solution:** Re-authenticate by calling `/sanctum/csrf-cookie` then `/auth/login`.
    
    ```json
    { "message": "Unauthenticated." }
    ```
  </Accordion>
  
  <Accordion title="403 Forbidden" icon="ban">
    <Badge color="orange">403</Badge> User lacks permission for this resource.
    
    **Solution:** Check that your account has the required role or ownership.
  </Accordion>
  
  <Accordion title="419 Session Expired" icon="clock">
    <Badge color="gray">419</Badge> CSRF token mismatch or session timeout.
    
    **Solution:** Refresh CSRF token by calling `/sanctum/csrf-cookie` again.
  </Accordion>
</AccordionGroup>

---

## Social Login

BeatPass supports social authentication providers:

<CardGroup cols={2}>
  <Card title="Google" icon="google" color="#4285F4">
    <Badge color="green" icon="check">Available</Badge>
  </Card>
  <Card title="Twitter / X" icon="x-twitter" color="#000000">
    <Badge color="green" icon="check">Available</Badge>
  </Card>
</CardGroup>

<Note>
  Social logins create a BeatPass account and session automatically. You can link additional providers in Account Settings.
</Note>

---

## Next Steps

<CardGroup cols={2}>
  <Card title="API Reference" icon="code" href="/developers/api-reference/overview">
    See available endpoints.
  </Card>
  <Card title="Rate Limits" icon="gauge" href="/developers/rate-limits">
    Understand request limits.
  </Card>
</CardGroup>
